{% extends 'core/base.html' %}
{% load static %}

{% block title %}{{ video.title }} - VideoTube{% endblock %}

{% block content %}
<div class="watch-page">
    <div class="watch-main">
        <!-- Video Player -->
        <div class="video-player">
            {% if video.video_url %}
            <video controls autoplay>
                <source src="{{ video.video_url }}" type="video/mp4">
                Your browser does not support the video tag.
            </video>
            {% else %}
            <div id="youtube-player" data-video-id="{{ video.id }}"></div>
            {% endif %}
        </div>
        <div class="video-fallback {% if not video.video_url %}is-hidden{% endif %}" id="video-fallback">
            <span>Having trouble playing this video?</span>
            {% if video.provider == 'external' %}
            <a href="{{ video.source_url }}" target="_blank" rel="noopener">Open video</a>
            {% else %}
            <a href="{{ video.youtube_url }}" target="_blank" rel="noopener">Watch on YouTube</a>
            {% endif %}
        </div>

        <!-- Video Info -->
        <div class="video-primary-info">
            <h1 class="video-title-large">{{ video.title }}</h1>
            <div class="video-info-bar">
                <div class="video-stats">
                    <span>{{ video.formatted_views }} views</span>
                    <span class="separator">â€¢</span>
                    <span>{{ video.published_at|slice:":10" }}</span>
                </div>
                <div class="video-actions">
                    <button class="action-btn">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor"
                                d="M1 21h4V9H1v12zm22-11c0-1.1-.9-2-2-2h-6.31l.95-4.57.03-.32c0-.41-.17-.79-.44-1.06L14.17 1 7.59 7.59C7.22 7.95 7 8.45 7 9v10c0 1.1.9 2 2 2h9c.83 0 1.54-.5 1.84-1.22l3.02-7.05c.09-.23.14-.47.14-.73v-2z" />
                        </svg>
                        <span>{{ video.like_count|default:"0" }}</span>
                    </button>
                    <button class="action-btn">
                        <svg viewBox="0 0 24 24" width="24" height="24">
                            <path fill="currentColor"
                                d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z" />
                        </svg>
                        Share
                    </button>
                </div>
            </div>
        </div>

        <!-- Channel Info -->
        <div class="video-secondary-info">
            <div class="channel-info">
                {% if video.channel_url %}
                <a href="{{ video.channel_url }}" target="_blank" class="channel-avatar">
                    {{ video.channel_title|slice:":1"|upper }}
                </a>
                {% else %}
                <a href="https://www.youtube.com/channel/{{ video.channel_id }}" target="_blank" class="channel-avatar">
                    {{ video.channel_title|slice:":1"|upper }}
                </a>
                {% endif %}
                <div class="channel-details">
                    {% if video.channel_url %}
                    <a href="{{ video.channel_url }}" target="_blank" class="channel-name">
                        {{ video.channel_title }}
                        <svg class="verified-badge" viewBox="0 0 24 24" width="14" height="14">
                            <path fill="currentColor"
                                d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zM9.8 17.3l-4.2-4.1L7 11.8l2.8 2.7L17 7.4l1.4 1.4-8.6 8.5z" />
                        </svg>
                    </a>
                    {% else %}
                    <a href="https://www.youtube.com/channel/{{ video.channel_id }}" target="_blank"
                        class="channel-name">
                        {{ video.channel_title }}
                        <svg class="verified-badge" viewBox="0 0 24 24" width="14" height="14">
                            <path fill="currentColor"
                                d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10 10-4.5 10-10S17.5 2 12 2zM9.8 17.3l-4.2-4.1L7 11.8l2.8 2.7L17 7.4l1.4 1.4-8.6 8.5z" />
                        </svg>
                    </a>
                    {% endif %}
                </div>
            </div>
            <div class="video-description">
                <p>{{ video.description|default:"No description available."|truncatewords:50 }}</p>
            </div>
        </div>
    </div>

    <!-- Related Videos -->
    <aside class="watch-sidebar">
        <h4>Up next</h4>
        {% for related in related_videos %}
        <div class="related-video">
            <a href="{% url 'youtube_video_detail' related.id %}" class="related-thumbnail">
                <img src="{{ related.thumbnail }}" alt="{{ related.title }}">
                <span class="video-duration">{{ related.duration|default:"0:00" }}</span>
            </a>
            <div class="related-info">
                <a href="{% url 'youtube_video_detail' related.id %}" class="related-title">{{ related.title }}</a>
                {% if related.channel_url %}
                <a href="{{ related.channel_url }}" target="_blank" class="related-channel">{{ related.channel_title }}</a>
                {% else %}
                <a href="https://www.youtube.com/channel/{{ related.channel_id }}" target="_blank"
                    class="related-channel">{{ related.channel_title }}</a>
                {% endif %}
                <div class="related-meta">{{ related.formatted_views }} views</div>
            </div>
        </div>
        {% empty %}
        <p>No related videos</p>
        {% endfor %}
    </aside>
</div>
{% endblock %}

{% block extra_js %}
{% if not video.video_url %}
<script src="{% static 'core/js/youtube_player.js' %}"></script>
{% endif %}
{% endblock %}
